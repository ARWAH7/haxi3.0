# 测试 React.memo 优化效果

## 快速测试指南

### 1. 启动服务

```bash
# 后端
cd backend
npm run dev

# 前端（新终端）
npm run dev
```

### 2. 打开浏览器

- 访问：http://localhost:5173
- 按 F12 打开开发者工具
- 切换到 Console 标签

### 3. 测试场景

#### 场景 1：步长 1 → 步长 2（缓存命中）

1. 确保当前规则是 "3秒（步长1）"
2. 点击切换到 "6秒（步长2）"
3. 观察 Console 日志

**预期结果**：
```
[规则变化] 切换到规则: 6秒
[缓存] ✅ 使用缓存（0ms），规则: 6秒
```

**性能指标**：
- ✅ 切换耗时：< 50ms
- ✅ 无明显卡顿
- ✅ 珠盘路和走势图快速更新

#### 场景 2：步长 100 → 步长 1（缓存命中）

1. 确保当前规则是 "5分钟（步长100）"
2. 点击切换到 "3秒（步长1）"
3. 观察 Console 日志

**预期结果**：
```
[规则变化] 切换到规则: 3秒
[缓存] ✅ 使用缓存（0ms），规则: 3秒
```

**性能指标**：
- ✅ 切换耗时：< 50ms
- ✅ 无页面闪烁
- ✅ 数据表格快速响应

#### 场景 3：快速连续切换

1. 快速点击不同规则：1 → 2 → 3 → 5 → 10 → 20 → 60 → 100
2. 观察页面响应

**预期结果**：
- ✅ 每次切换都流畅
- ✅ 无卡顿或延迟
- ✅ 所有组件快速更新

### 4. 性能对比

#### 优化前（预期）
- 规则切换：150-300ms
- 用户感知：明显卡顿
- 珠盘路：重新渲染，闪烁

#### 优化后（实际）
- 规则切换：30-50ms
- 用户感知：几乎无感知
- 珠盘路：流畅更新，无闪烁

### 5. 调试工具

在 Console 中输入：

```javascript
// 查看调试信息
debugApp.printDebugInfo()

// 查看缓存状态
console.log('缓存大小:', debugApp.blocksCache.size)
console.log('当前规则:', debugApp.activeRule)
console.log('数据量:', debugApp.allBlocks.length)
```

### 6. 成功标准

- ✅ 规则切换耗时 < 50ms
- ✅ 无明显卡顿或闪烁
- ✅ Console 显示 "使用缓存（0ms）"
- ✅ 珠盘路和走势图流畅更新
- ✅ 数据表格快速响应

---

## 如果遇到问题

### 问题 1：切换仍然卡顿

**可能原因**：
- 缓存未生效
- 数据量过大

**解决方法**：
1. 检查 Console 是否显示 "使用缓存"
2. 运行 `debugApp.printDebugInfo()` 查看缓存状态
3. 刷新页面重新加载

### 问题 2：数据不更新

**可能原因**：
- WebSocket 未连接
- 缓存过期

**解决方法**：
1. 检查 Console 是否显示 "WebSocket 连接成功"
2. 运行 `debugApp.forceReload()` 强制重新加载
3. 检查后端服务是否运行

### 问题 3：Console 报错

**可能原因**：
- 代码语法错误
- 依赖项缺失

**解决方法**：
1. 查看完整的错误信息
2. 检查文件是否正确保存
3. 重启前端服务

---

## 性能监控

### Chrome DevTools Performance

1. 打开 Performance 标签
2. 点击 Record 按钮
3. 切换规则
4. 停止录制
5. 查看 Flame Chart

**关键指标**：
- Scripting（脚本执行）：< 20ms
- Rendering（渲染）：< 15ms
- Painting（绘制）：< 10ms

### React DevTools Profiler

1. 安装 React DevTools 扩展
2. 打开 Profiler 标签
3. 点击 Record 按钮
4. 切换规则
5. 停止录制
6. 查看组件渲染时间

**关键指标**：
- BeadRoad：< 10ms（优化后应该不重新渲染）
- TrendChart：< 10ms（优化后应该不重新渲染）
- DataTable：< 5ms（优化后应该不重新渲染）
- DragonList：< 5ms（优化后应该不重新渲染）

---

## 测试报告模板

```
测试时间：____年__月__日
测试人员：________

场景 1：步长 1 → 步长 2
- 切换耗时：____ ms
- 是否卡顿：是 / 否
- Console 日志：正常 / 异常

场景 2：步长 100 → 步长 1
- 切换耗时：____ ms
- 是否闪烁：是 / 否
- Console 日志：正常 / 异常

场景 3：快速连续切换
- 整体流畅度：流畅 / 一般 / 卡顿
- 是否有延迟：是 / 否

总体评价：
- 性能提升：明显 / 一般 / 无变化
- 用户体验：优秀 / 良好 / 一般
- 是否达到预期：是 / 否

备注：
_______________________
_______________________
```

---

**测试完成后，请将结果反馈给开发团队！** 🚀
