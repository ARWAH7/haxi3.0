# ğŸ” 132 æ˜¾ç¤ºé—®é¢˜è¯Šæ–­æŠ¥å‘Š

## è°ƒè¯•è¾“å‡ºåˆ†æ

```
å½“å‰è§„åˆ™: {id: 'rule-1770364831108-1', label: '6ç§’', value: 2, ...}
ç ç›˜è·¯è¡Œæ•°: 6
èµ°åŠ¿è·¯è¡Œæ•°: 6
åç«¯è¿”å›: 341
å‰ç«¯ä½¿ç”¨: 264
éœ€æ±‚é‡: 264
```

## æ•°æ®æµåˆ†æ

### 1. åç«¯ â†’ å‰ç«¯
- **è¯·æ±‚**ï¼š264 æ¡ï¼ˆæ­¥é•¿ 2ï¼‰
- **åç«¯è¿”å›**ï¼š341 æ¡ âŒï¼ˆåº”è¯¥æ˜¯ 264 æ¡ï¼‰
- **å‰ç«¯æˆªå–**ï¼š264 æ¡ âœ…

### 2. å‰ç«¯ â†’ ç ç›˜è·¯ç»„ä»¶
- **ä¼ å…¥ BeadRoad**ï¼š264 æ¡
- **ç ç›˜è·¯è¡Œæ•°**ï¼š6 è¡Œ
- **é¢„æœŸæ˜¾ç¤º**ï¼š6 è¡Œ Ã— 44 åˆ— = 264 ä¸ªæ ¼å­
- **å®é™…æ˜¾ç¤º**ï¼š132 ä¸ªæ ¼å­ âŒ

## é—®é¢˜æ ¹æº

### é—®é¢˜1ï¼šåç«¯è¿”å› 341 æ¡ï¼ˆä¸æ˜¯ 264 æ¡ï¼‰

**ä½ç½®**ï¼š`backend/src/api.ts` ç¬¬ 36 è¡Œ

**ä»£ç **ï¼š
```typescript
const resultBlocks = filteredBlocks.slice(0, limit);
```

**åˆ†æ**ï¼š
- ä»£ç é€»è¾‘æ­£ç¡®
- ä½†å®é™…è¿”å›äº† 341 æ¡
- **å¯èƒ½åŸå› **ï¼š
  1. `limit` å‚æ•°ä¼ é€’é”™è¯¯
  2. å‰ç«¯è¯·æ±‚æ—¶ `requiredDataCount` ä¸æ˜¯ 264
  3. ç¼“å­˜é—®é¢˜

**éªŒè¯æ–¹æ³•**ï¼š
åœ¨åç«¯æ·»åŠ æ—¥å¿—ï¼ŒæŸ¥çœ‹å®é™…çš„ `limit` å€¼ï¼š
```typescript
console.log(`[API] ğŸ” limit å‚æ•°: ${limit}, ç±»å‹: ${typeof limit}`);
```

### é—®é¢˜2ï¼šç ç›˜è·¯åªæ˜¾ç¤º 132 ä¸ªæ ¼å­

**ä½ç½®**ï¼š`utils/helpers.ts` - `calculateBeadGrid` å‡½æ•°

**åˆ†æ**ï¼š
- è¾“å…¥ï¼š264 æ¡æ•°æ®
- è¡Œæ•°ï¼š6 è¡Œ
- é¢„æœŸï¼š44 åˆ—ï¼ˆ264 Ã· 6 = 44ï¼‰
- å®é™…ï¼š22 åˆ—ï¼ˆ132 Ã· 6 = 22ï¼‰

**å¯èƒ½åŸå› **ï¼š
1. **æ­¥é•¿è®¡ç®—é”™è¯¯**ï¼šå½“å‰è§„åˆ™æ­¥é•¿æ˜¯ 2ï¼Œå¯èƒ½å¯¼è‡´è®¡ç®—æ—¶è·³è¿‡äº†ä¸€åŠçš„æ•°æ®
2. **ç´¢å¼•è®¡ç®—é”™è¯¯**ï¼š`calculateBeadGrid` ä¸­çš„ `idx = Math.floor((b.height - epoch) / interval)` å¯èƒ½æœ‰é—®é¢˜
3. **æ•°æ®é‡å¤è¿‡æ»¤**ï¼šæ•°æ®åœ¨ä¼ å…¥ `calculateBeadGrid` ä¹‹å‰å·²ç»è¢«è¿‡æ»¤è¿‡ä¸€æ¬¡ï¼Œå‡½æ•°å†…éƒ¨åˆç”¨ `interval` è¿‡æ»¤äº†ä¸€æ¬¡

## å…³é”®å‘ç°

**`calculateBeadGrid` å‡½æ•°çš„é—®é¢˜**ï¼š

```typescript
const indexedBlocks = chronological.map(b => ({
  block: b,
  idx: Math.floor((b.height - epoch) / interval)  // â† è¿™é‡Œï¼
}));
```

**é—®é¢˜**ï¼š
- å‰ç«¯å·²ç»ä¼ å…¥äº† 264 æ¡**å·²è¿‡æ»¤**çš„æ•°æ®ï¼ˆæ­¥é•¿ 2ï¼‰
- ä½† `calculateBeadGrid` åˆç”¨ `interval = 2` é‡æ–°è®¡ç®—ç´¢å¼•
- å¯¼è‡´æ•°æ®è¢«"äºŒæ¬¡è¿‡æ»¤"ï¼Œåªæ˜¾ç¤ºä¸€åŠ

**ä¸¾ä¾‹**ï¼š
- å‡è®¾ä¼ å…¥çš„ 264 æ¡æ•°æ®çš„åŒºå—é«˜åº¦æ˜¯ï¼š[100, 102, 104, 106, ...]ï¼ˆæ­¥é•¿ 2ï¼‰
- `calculateBeadGrid` è®¡ç®—ç´¢å¼•æ—¶ï¼š
  - 100: idx = (100 - 0) / 2 = 50
  - 102: idx = (102 - 0) / 2 = 51
  - 104: idx = (104 - 0) / 2 = 52
- ä½†å®é™…åº”è¯¥æ˜¯ï¼š
  - 100: idx = 0
  - 102: idx = 1
  - 104: idx = 2

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šä¿®å¤ `calculateBeadGrid` å‡½æ•°ï¼ˆæ¨èï¼‰

**åŸç†**ï¼šå‰ç«¯ä¼ å…¥çš„æ•°æ®å·²ç»æ˜¯è¿‡æ»¤åçš„ï¼Œä¸éœ€è¦å†ç”¨ `interval` è®¡ç®—ç´¢å¼•ã€‚

**ä¿®æ”¹**ï¼š
```typescript
// ä¿®æ”¹å‰
const indexedBlocks = chronological.map(b => ({
  block: b,
  idx: Math.floor((b.height - epoch) / interval)
}));

// ä¿®æ”¹å
const indexedBlocks = chronological.map((b, i) => ({
  block: b,
  idx: i  // ç›´æ¥ä½¿ç”¨æ•°ç»„ç´¢å¼•ï¼Œå› ä¸ºæ•°æ®å·²ç»æ˜¯è¿‡æ»¤åçš„
}));
```

### æ–¹æ¡ˆBï¼šä¿®å¤åç«¯è¿”å›æ•°é‡

**ä½ç½®**ï¼š`backend/src/api.ts`

**æ·»åŠ è°ƒè¯•æ—¥å¿—**ï¼š
```typescript
console.log(`[API] ğŸ” limit å‚æ•°: ${limit}, ç±»å‹: ${typeof limit}`);
console.log(`[API] ğŸ” filteredBlocks.length: ${filteredBlocks.length}`);
console.log(`[API] ğŸ” resultBlocks.length: ${resultBlocks.length}`);
```

## ä¿®å¤ä¼˜å…ˆçº§

1. **ä¼˜å…ˆä¿®å¤æ–¹æ¡ˆA**ï¼šä¿®å¤ `calculateBeadGrid` å‡½æ•°ï¼ˆç«‹å³è§£å†³ 132 æ˜¾ç¤ºé—®é¢˜ï¼‰
2. **ç„¶åä¿®å¤æ–¹æ¡ˆB**ï¼šç¡®ä¿åç«¯è¿”å›æ­£ç¡®æ•°é‡ï¼ˆä¼˜åŒ–æ€§èƒ½ï¼‰

---

**è¯Šæ–­æ—¶é—´**ï¼š2026-02-06
**çŠ¶æ€**ï¼šâœ… é—®é¢˜å®šä½å®Œæˆï¼Œç­‰å¾…ä¿®å¤
